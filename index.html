<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Збирач сердець — проста гра на HTML/JS</title>
  <style>
    :root{ --bg:#081026; --panel:#071423; --accent:#ff5a78; --text:#dbeefe }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,Roboto,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,var(--bg),#041026);color:var(--text)}
    .wrap{max-width:980px;margin:24px auto;padding:18px}
    header{display:flex;align-items:center;gap:12px}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:#9fc6ee}

    .game-area{
      margin-top:18px;display:grid;grid-template-columns:1fr 260px;gap:18px;align-items:start
    }

    /* Контейнер гри */
    .screen{
      width:100%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;position:relative;overflow:hidden;
      aspect-ratio: 4/3; min-height:480px; box-shadow: 0 10px 30px rgba(2,6,23,0.6);
    }

    /* ігрове поле (canvas) */
    canvas{width:100%;height:100%;display:block;border-radius:8px;background:linear-gradient(180deg,#042033 0%, #02121a 100%)}

    /* панель праворуч */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border-radius:12px;padding:14px}
    .stat{display:flex;justify-content:space-between;padding:8px 6px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.01)}
    .controls{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    button{cursor:pointer;border:0;padding:8px 10px;border-radius:8px;background:var(--panel);color:var(--text)}
    .btn-primary{background:var(--accent);color:#081026;font-weight:700}
    .small{font-size:13px;color:#a7cde8}

    /* мобайл — вертикальна компоновка */
    @media (max-width:880px){ .game-area{grid-template-columns:1fr} .screen{min-height:360px} }

    /* прості підказки */
    .hint{font-size:13px;color:#cfe6ff;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Збирач сердець</h1>
        <p class="lead">Лови падаючі серця, уникай бомб. Клавіші ← → або сенсорне керування.</p>
      </div>
    </header>

    <div class="game-area">
      <div class="screen">
        <canvas id="game" aria-label="Ігровий екран"></canvas>
        <!-- HUD overlay -->
        <div id="hud" style="position:absolute;left:12px;top:12px;color:var(--text);font-weight:600;"></div>
        <div id="overlay" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none"></div>
      </div>

      <aside class="panel" aria-label="Панель гри">
        <div class="stat"><div>Рахунок</div><div id="score">0</div></div>
        <div class="stat"><div>Життя</div><div id="lives">3</div></div>
        <div class="stat"><div>Рівень</div><div id="level">1</div></div>

        <div class="controls">
          <button id="startBtn" class="btn-primary">Почати гру</button>
          <button id="pauseBtn">Пауза</button>
          <button id="resetBtn">Скинути</button>
        </div>

        <div class="hint">Правила: збирай <span style="color:var(--accent)">серця</span> (+10). Уникай <span style="color:#ffcc66">бомб</span> (-1 життя). З кожним рівнем падає більше предметів.</div>
        <hr style="margin:10px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">
        <div class="small">Керування:</div>
        <ul class="small" style="margin:6px 0 0 18px;padding:0;">
          <li>Клавіші ← → або A/D</li>
          <li>На мобайлі — торкнись лівої/правої частини екрану</li>
        </ul>
      </aside>
    </div>
  </div>

  <script>
    // Основні змінні
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let W=800, H=600; // віртуальна роздільність
    let scale = 1;

    // HUD
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const levelEl = document.getElementById('level');
    const overlay = document.getElementById('overlay');

    // Кнопки
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');

    // Ігрові дані
    let player = {x: W/2, y: H-60, w:72, h:36, speed: 420};
    let items = []; // падаючі об'єкти
    let score = 0, lives=3, level=1;
    let running=false, paused=false;
    let lastTime=0, spawnTimer=0, spawnInterval=1.2; // секунди

    // Налаштування рівнів
    function updateDifficulty(){
      spawnInterval = Math.max(0.45, 1.2 - (level-1)*0.12);
    }

    // Розміри canvas під розмір блоку
    function resize(){
      const rect = canvas.parentElement.getBoundingClientRect();
      // Підтримуємо співвідношення W:H
      canvas.width = W; canvas.height = H; // внутрішня резолюція фіксована
      // але стилями масштабируемо
      canvas.style.width = '100%';
      canvas.style.height = '100%';
    }
    window.addEventListener('resize', resize);
    resize();

    // Корисні функції
    function rand(min,max){ return Math.random()*(max-min)+min }

    // Створення об'єкта: тип 'heart' або 'bomb'
    function spawnItem(){
      const x = rand(40, W-40);
      const isBomb = Math.random() < Math.min(0.12 + level*0.03, 0.35); // з ростом рівня більше бомб
      const speed = rand(80 + level*18, 180 + level*24);
      items.push({x, y:-30, r: rand(12,26), vy: speed, type: isBomb ? 'bomb' : 'heart', wobble: Math.random()*1.5});
    }

    // Малювання гравця
    function drawPlayer(){
      ctx.save();
      ctx.translate(player.x, player.y);
      // платформа
      ctx.fillStyle = '#0ec';
      roundRect(ctx, -player.w/2, -player.h/2, player.w, player.h, 10);
      ctx.fill();
      // серце-логотип на платформі
      drawHeart(ctx, 0, -12, 10, '#ff5a78');
      ctx.restore();
    }

    // Малювання серця
    function drawHeart(ctx, cx, cy, size, color){
      ctx.save(); ctx.translate(cx, cy);
      ctx.scale(size/10, size/10);
      ctx.beginPath();
      ctx.moveTo(0,3);
      ctx.bezierCurveTo(0,-6, -10,-6, -10,0);
      ctx.bezierCurveTo(-10,6,0,12,0,16);
      ctx.bezierCurveTo(0,12,10,6,10,0);
      ctx.bezierCurveTo(10,-6,0,-6,0,3);
      ctx.closePath();
      ctx.fillStyle=color; ctx.fill();
      ctx.restore();
    }

    // Малювання бомби
    function drawBomb(ctx, x, y, r){
      ctx.save();
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fillStyle='#fff1d6'; ctx.fill();
      ctx.beginPath(); ctx.arc(x- r*0.3, y - r*0.2, r*0.35, 0, Math.PI*2); ctx.fillStyle='#282828'; ctx.fill();
      // гніт
      ctx.strokeStyle='#444'; ctx.lineWidth=3; ctx.beginPath(); ctx.moveTo(x + r*0.6, y - r*0.8); ctx.lineTo(x + r*1.3, y - r*1.6); ctx.stroke();
      ctx.restore();
    }

    // допоміжні: круглі прямокутники
    function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }

    // Фізика і логіка
    let keys = {};
    window.addEventListener('keydown', e=>{ keys[e.key.toLowerCase()] = true; if(['arrowleft','arrowright',' '].includes(e.key.toLowerCase())) e.preventDefault(); });
    window.addEventListener('keyup', e=>{ keys[e.key.toLowerCase()] = false; });

    // Торкання для мобайла
    canvas.addEventListener('touchstart', (e)=>{
      e.preventDefault(); const t = e.touches[0]; const rect = canvas.getBoundingClientRect(); const x = (t.clientX - rect.left)/rect.width * W;
      // якщо лівіше центру — вліво, інакше вправо (короткий тап буде кроком)
      if(x < W/2) movePlayer(-1); else movePlayer(1);
    }, {passive:false});

    // Короткий рух гравця для торкань
    function movePlayer(dir){ player.x += dir * 80; player.x = Math.max(player.w/2, Math.min(W - player.w/2, player.x)); }

    // Геймлуп
    function gameLoop(ts){
      if(!running || paused){ lastTime = ts; requestAnimationFrame(gameLoop); return; }
      const dt = Math.min(0.06, (ts - lastTime)/1000);
      lastTime = ts;

      // керування
      let dir = 0;
      if(keys['arrowleft'] || keys['a']) dir = -1;
      if(keys['arrowright'] || keys['d']) dir = 1;
      player.x += dir * player.speed * dt;
      // межі
      player.x = Math.max(player.w/2, Math.min(W - player.w/2, player.x));

      // спавн
      spawnTimer += dt;
      if(spawnTimer >= spawnInterval){ spawnTimer = 0; spawnItem(); }

      // оновлення предметів
      for(let i = items.length-1; i>=0; i--){
        const it = items[i];
        // горизонтальна дрейфовка
        it.x += Math.sin((performance.now()/1000 + it.wobble) * 1.4) * 12 * dt;
        it.y += it.vy * dt;
        // перевірка колізії з гравцем
        const dx = it.x - player.x; const dy = it.y - player.y + player.h*0.2;
        const dist = Math.hypot(dx, dy);
        if(dist < it.r + Math.max(player.w, player.h)/2){
          // зіткнення
          if(it.type === 'heart'){ score += 10; }
          else { lives -= 1; flashOverlay('#ffcc66'); }
          items.splice(i,1);
          continue;
        }
        // якщо впав нижче екрану
        if(it.y - it.r > H){
          // якщо пропущено серце — мінус очки
          if(it.type === 'heart'){ score = Math.max(0, score - 5); }
          items.splice(i,1);
        }
      }

      // апдейт рівня
      if(score >= level * 100){ level +=1; updateDifficulty(); flashOverlay('#7bfcc4'); }

      // перевірка життя
      if(lives <= 0){ running = false; showGameOver(); }

      // рендер
      render();

      // оновлення HUD
      scoreEl.textContent = score;
      livesEl.textContent = lives;
      levelEl.textContent = level;

      requestAnimationFrame(gameLoop);
    }

    // Рендер сцени
    function render(){
      ctx.clearRect(0,0,W,H);
      // фон: м'який градієнт зоряного неба
      for(let i=0;i<40;i++){
        // малюнок зірок (оптимізовано: можна кешувати, але для простоти малюємо мінімально)
      }
      // платформа
      drawPlayer();
      // предмети
      for(const it of items){
        if(it.type === 'heart'){
          drawHeart(ctx, it.x, it.y, it.r, '#ff5a78');
        } else {
          drawBomb(ctx, it.x, it.y, it.r);
        }
      }

      // невеличкий текст у верхньому лівому куті
      ctx.fillStyle = 'rgba(255,255,255,0.06)'; ctx.font = '12px Inter, Arial'; ctx.fillText('Збирай серця — будь уважним!', 12, 20);
    }

    // Показати Game Over
    function showGameOver(){
      overlay.innerHTML = '';
      const box = document.createElement('div'); box.style.pointerEvents='auto';
      box.style.background='rgba(0,0,0,0.55)'; box.style.padding='18px'; box.style.borderRadius='12px'; box.style.textAlign='center'; box.style.color='#fff';
      box.innerHTML = `<div style="font-size:22px;font-weight:700;margin-bottom:8px">Гра завершена</div><div style="margin-bottom:10px">Рахунок: ${score}</div>`;
      const but = document.createElement('button'); but.textContent='Грати знову'; but.className='btn-primary'; but.style.marginTop='6px';
      but.onclick = ()=>{ resetGame(); startGame(); overlay.innerHTML=''; };
      box.appendChild(but); overlay.appendChild(box);
    }

    // Вспливаня при певних подіях
    function flashOverlay(color){
      const el = document.createElement('div'); el.style.position='absolute'; el.style.inset='0'; el.style.background=color; el.style.opacity='0.0'; el.style.pointerEvents='none'; overlay.appendChild(el);
      // анімація простим таймаутом
      let a=0; const id = setInterval(()=>{ a+=0.06; el.style.opacity = (0.65 * Math.sin(a*Math.PI)) ; if(a>1){ clearInterval(id); overlay.removeChild(el);} },16);
    }

    // Кнопки керування
    startBtn.addEventListener('click', ()=>{ if(!running) startGame(); else { paused = false; } });
    pauseBtn.addEventListener('click', ()=>{ paused = !paused; pauseBtn.textContent = paused ? 'Відновити' : 'Пауза'; });
    resetBtn.addEventListener('click', ()=>{ resetGame(); });

    function startGame(){ running=true; paused=false; lastTime = performance.now(); spawnTimer=0; requestAnimationFrame(gameLoop); }
    function resetGame(){ items = []; score=0; lives=3; level=1; updateDifficulty(); overlay.innerHTML=''; }

    // Ініціалізація
    resetGame();

    // стартова анімація, чекаємо на перший запуск
    overlay.innerHTML = '';
    const ready = document.createElement('div'); ready.style.pointerEvents='none'; ready.style.color='rgba(255,255,255,0.85)'; ready.style.fontSize='14px'; ready.style.textAlign='center'; ready.innerHTML = '<div style="font-weight:700;font-size:20px;margin-bottom:8px">Готово до гри</div><div class="small">Натисни "Почати гру"</div>';
    overlay.appendChild(ready);

    // Запускаємо resize і рендер для правильного вигляду
    resize(); render();

    // Підтримка високого DPI
    function fixDPI(){ const dpr = window.devicePixelRatio || 1; canvas.width = W * dpr; canvas.height = H * dpr; canvas.style.width='100%'; canvas.style.height='100%'; ctx.setTransform(dpr,0,0,dpr,0,0); }
    fixDPI(); window.addEventListener('resize', ()=>{ fixDPI(); });

    // Поінтимні доопрацювання: збереження рекорду в localStorage
    function saveHighScore(){ const hs = Number(localStorage.getItem('hearts_high')||0); if(score>hs) localStorage.setItem('hearts_high', score); }
    window.addEventListener('beforeunload', ()=> saveHighScore());

    // Пошук клатчів та покращення: при закінченні гри зберігаємо
    function onGameEnd(){ saveHighScore(); }

    // Дрібні оптимізації: очищення масиву при довгому спокої
    setInterval(()=>{ if(items.length>120) items.splice(0, items.length-100); }, 5000);

  </script>
</body>
</html>